<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHOS-AI Hospital Management System v2.0</title>
    <style>
        /* ========================================
           GLOBAL STYLES
           ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1a8673;
            --secondary-color: #f39c12;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
            --border-color: #ecf0f1;
            --font-sm: 12px;
            --font-base: 14px;
            --font-md: 16px;
            --font-lg: 18px;
            --font-xl: 24px;
            --font-2xl: 32px;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --border-radius: 8px;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --box-shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: var(--font-base);
            line-height: 1.6;
            color: var(--dark-text);
            background-color: var(--light-bg);
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.2;
            margin-bottom: var(--spacing-md);
        }

        h1 { font-size: var(--font-2xl); }
        h2 { font-size: var(--font-xl); }
        h3 { font-size: var(--font-lg); }

        p { margin-bottom: var(--spacing-md); }

        a {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }

        a:hover { color: var(--secondary-color); }

        /* ========================================
           BUTTONS
           ======================================== */
        .btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--border-radius);
            font-size: var(--font-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #156c5a;
            box-shadow: var(--box-shadow-lg);
        }

        .btn-primary:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #e67e22;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #229954;
        }

        .btn-block { width: 100%; }
        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: var(--font-sm);
        }

        /* ========================================
           FORMS
           ======================================== */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
            color: var(--dark-text);
        }

        input, textarea, select {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: var(--font-base);
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 134, 115, 0.1);
        }

        input:disabled {
            background-color: #f0f0f0;
            cursor: not-allowed;
        }

        /* ========================================
           CARDS
           ======================================== */
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .card-header {
            border-bottom: 2px solid var(--border-color);
            padding-bottom: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .card-header h2 {
            margin: 0;
        }

        .card-body {
            padding: var(--spacing-md) 0;
        }

        /* ========================================
           ALERTS
           ======================================== */
        .alert {
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-md);
            border-left: 4px solid;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .alert.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background-color: #d5f4e6;
            color: #27ae60;
            border-left-color: #27ae60;
        }

        .alert-danger {
            background-color: #fadbd8;
            color: #e74c3c;
            border-left-color: #e74c3c;
        }

        .alert-info {
            background-color: #d6eaf8;
            color: #3498db;
            border-left-color: #3498db;
        }

        .alert-warning {
            background-color: #fdebd0;
            color: #f39c12;
            border-left-color: #f39c12;
        }

        /* ========================================
           HEADER/NAVBAR
           ======================================== */
        .header {
            background-color: var(--primary-color);
            color: white;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            display: none;
        }

        .header.show {
            display: block;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .header-logo h1 {
            margin: 0;
            color: white;
            font-size: var(--font-xl);
        }

        .header-logo a {
            color: white;
        }

        .header-nav {
            display: flex;
            gap: var(--spacing-lg);
            flex: 1;
            flex-wrap: wrap;
        }

        .header-nav a {
            color: white;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .header-nav a:hover {
            opacity: 0.8;
        }

        .header-user {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .user-name {
            color: white;
            font-weight: 600;
        }

        /* ========================================
           AUTH CONTAINER
           ======================================== */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a8673 0%, #2ecc71 100%);
            padding: var(--spacing-md);
        }

        .auth-box {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-lg);
            padding: var(--spacing-xl);
            width: 100%;
            max-width: 500px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: var(--spacing-lg);
        }

        .auth-header h1 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }

        .auth-box h2 {
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }

        .auth-footer {
            text-align: center;
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
        }

        /* ========================================
           MAIN CONTENT
           ======================================== */
        .main-content {
            display: none;
            padding: var(--spacing-lg) 0;
        }

        .main-content.show {
            display: block;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        /* ========================================
           WELCOME SECTION
           ======================================== */
        .welcome-section {
            background: linear-gradient(135deg, var(--primary-color) 0%, #156c5a 100%);
            color: white;
            padding: var(--spacing-xl);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-xl);
        }

        .welcome-section h1 {
            margin: 0 0 var(--spacing-sm) 0;
        }

        .welcome-section p {
            margin: 0;
            opacity: 0.9;
        }

        /* ========================================
           QUICK ACTIONS
           ======================================== */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .action-btn {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            background-color: white;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .action-btn:hover {
            border-color: var(--primary-color);
            box-shadow: var(--box-shadow-lg);
            transform: translateY(-5px);
        }

        .action-icon {
            font-size: 32px;
            min-width: 40px;
        }

        .action-btn h3 {
            margin: 0 0 var(--spacing-xs) 0;
            color: var(--primary-color);
        }

        .action-btn p {
            margin: 0;
            font-size: var(--font-sm);
        }

        /* ========================================
           STATS GRID
           ======================================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, #156c5a 100%);
            color: white;
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: var(--spacing-md);
        }

        .stat-card h3 {
            margin: 0 0 var(--spacing-md) 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: var(--font-base);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin: 0;
        }

        /* ========================================
           APPOINTMENT CARDS
           ======================================== */
        .appointment-card {
            background-color: white;
            border: 2px solid var(--border-color);
            border-left: 5px solid var(--primary-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            transition: all 0.3s ease;
        }

        .appointment-card:hover {
            box-shadow: var(--box-shadow-lg);
        }

        .appointment-card.completed {
            border-left-color: var(--success-color);
        }

        .appointment-card.cancelled {
            border-left-color: var(--danger-color);
            opacity: 0.7;
        }

        .appointment-card.pending {
            border-left-color: var(--warning-color);
        }

        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: var(--spacing-md);
        }

        .appointment-header h4 {
            margin: 0;
            color: var(--primary-color);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: var(--border-radius);
            font-size: var(--font-sm);
            font-weight: 600;
            color: white;
        }

        .status-badge.scheduled {
            background-color: var(--info-color);
        }

        .status-badge.completed {
            background-color: var(--success-color);
        }

        .status-badge.cancelled {
            background-color: var(--danger-color);
        }

        .status-badge.pending {
            background-color: var(--warning-color);
        }

        .appointment-details {
            margin-bottom: var(--spacing-md);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            font-size: var(--font-sm);
        }

        .detail-label {
            font-weight: 600;
            color: var(--primary-color);
        }

        .appointment-actions {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        /* ========================================
           NOTIFICATION BANNER
           ======================================== */
        .notification-banner {
            background-color: #e8f5e9;
            border-left: 4px solid var(--success-color);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-md);
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        .notification-banner.warning {
            background-color: #fff3e0;
            border-left-color: var(--warning-color);
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-content h4 {
            margin: 0 0 var(--spacing-xs) 0;
        }

        .notification-content p {
            margin: 0;
            font-size: var(--font-sm);
        }

        /* ========================================
           HEALTH METRICS
           ======================================== */
        .health-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .metric-card {
            background-color: white;
            border-radius: var(--border-radius);
            border: 2px solid var(--border-color);
            padding: var(--spacing-lg);
            text-align: center;
        }

        .metric-label {
            font-size: var(--font-sm);
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
        }

        .metric-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-text);
            margin-bottom: var(--spacing-sm);
        }

        .metric-unit {
            font-size: var(--font-sm);
            color: var(--primary-color);
        }

        /* ========================================
           MEDICAL RECORDS
           ======================================== */
        .medical-record {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            border-left: 4px solid var(--primary-color);
        }

        .record-date {
            font-size: var(--font-sm);
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .record-title {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .record-content {
            font-size: var(--font-sm);
            line-height: 1.6;
            color: var(--dark-text);
        }

        /* ========================================
           CALENDAR/SLOTS
           ======================================== */
        .slots-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .slot-btn {
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            background-color: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
        }

        .slot-btn:hover:not(:disabled) {
            border-color: var(--primary-color);
            background-color: #f0f0f0;
        }

        .slot-btn.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .slot-btn:disabled {
            background-color: #f0f0f0;
            color: #ccc;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* ========================================
           TABS
           ======================================== */
        .tabs {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--border-color);
            overflow-x: auto;
            padding-bottom: var(--spacing-md);
        }

        .tab-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            background: none;
            cursor: pointer;
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--dark-text);
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.show {
            display: block;
        }

        /* ========================================
           MODAL
           ======================================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: var(--spacing-md);
        }

        .modal-header h2 {
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--dark-text);
        }

        /* ========================================
           TABLE
           ======================================== */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-lg);
        }

        table th {
            background-color: var(--light-bg);
            padding: var(--spacing-md);
            text-align: left;
            font-weight: 600;
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
        }

        table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        table tr:hover {
            background-color: var(--light-bg);
        }

        /* ========================================
           UTILITY CLASSES
           ======================================== */
        .mt-1 { margin-top: var(--spacing-sm); }
        .mt-2 { margin-top: var(--spacing-md); }
        .mt-3 { margin-top: var(--spacing-lg); }
        .mb-1 { margin-bottom: var(--spacing-sm); }
        .mb-2 { margin-bottom: var(--spacing-md); }
        .mb-3 { margin-bottom: var(--spacing-lg); }
        .p-2 { padding: var(--spacing-md); }
        .p-3 { padding: var(--spacing-lg); }

        .text-center { text-align: center; }
        .text-muted { color: #7f8c8d; }

        .loading {
            text-align: center;
            padding: var(--spacing-xl);
            font-size: var(--font-lg);
            color: var(--primary-color);
        }

        .hidden { display: none !important; }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        /* ========================================
           RESPONSIVE
           ======================================== */
        @media (max-width: 768px) {
            .header-container {
                flex-wrap: wrap;
            }

            .header-nav {
                order: 3;
                width: 100%;
                flex-wrap: wrap;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .appointment-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .appointment-actions {
                flex-direction: column;
            }

            .appointment-actions .btn {
                width: 100%;
            }

            .modal-content {
                width: 90%;
                padding: var(--spacing-lg);
            }

            .slots-container {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }

        /* ========================================
           PROFILE SECTION ENHANCEMENTS
           ======================================== */
        .profile-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .profile-info {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: var(--spacing-lg);
        }

        .profile-info h3 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: var(--spacing-md);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-color);
            font-size: var(--font-sm);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* ========================================
           AI ANALYTICS ENHANCEMENTS
           ======================================== */
        .analytics-access-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: var(--font-sm);
            font-weight: 600;
            margin-left: var(--spacing-sm);
        }

        .analytics-access-badge.doctor {
            background-color: #d6eaf8;
            color: var(--info-color);
        }

        .analytics-access-badge.patient {
            background-color: #d5f4e6;
            color: var(--success-color);
        }

        .restricted-content {
            background-color: #fadbd8;
            border-left: 4px solid var(--danger-color);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-md);
        }

        .restricted-content h4 {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--danger-color);
        }

        .restricted-content p {
            margin: 0;
            font-size: var(--font-sm);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="header-container">
            <div class="header-logo">
                <h1>üè• CHOS-AI v2.0</h1>
            </div>
            <nav class="header-nav" id="headerNav"></nav>
            <div class="header-user">
                <span class="user-name" id="userName"></span>
                <span class="user-role" id="userRole" style="color: white; font-size: 12px; margin-left: 8px; background-color: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 4px;"></span>
                <button class="btn btn-danger btn-sm" onclick="logout()" style="margin-left: 16px;">Logout</button>
            </div>
        </div>
    </header>

    <!-- Auth Pages -->
    <div id="loginPage" class="auth-container">
        <div class="auth-box">
            <div class="auth-header">
                <h1>üè• CHOS-AI v2.0</h1>
                <p>Hospital Management System</p>
            </div>
            <h2>Login</h2>
            <div id="loginError" class="alert alert-danger"></div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Your password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Login</button>
            </form>
            <div class="auth-footer">
                <p>Don't have an account? <a onclick="showRegister()">Register here</a></p>
            </div>
        </div>
    </div>

    <div id="registerPage" class="auth-container hidden">
        <div class="auth-box">
            <div class="auth-header">
                <h1>üè• CHOS-AI v2.0</h1>
                <p>Hospital Management System</p>
            </div>
            <h2>Create Account</h2>
            <div id="registerError" class="alert alert-danger"></div>
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="registerName" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="registerEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label>Account Type</label>
                    <select id="registerRole" required>
                        <option value="PATIENT">Patient</option>
                        <option value="DOCTOR">Doctor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="registerPhone" placeholder="9876543210">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="registerPassword" placeholder="At least 6 characters" required>
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="registerConfirm" placeholder="Confirm password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Register</button>
            </form>
            <div class="auth-footer">
                <p>Already have an account? <a onclick="showLogin()">Login here</a></p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="container">
            <!-- Patient Dashboard -->
            <div id="patientDashboard" class="hidden">
                <div class="welcome-section">
                    <h1>Welcome, <span id="patientName"></span>! üëã</h1>
                    <p>Patient Dashboard - Enhanced Hospital Management System</p>
                </div>

                <div class="quick-actions">
                    <div class="action-btn" onclick="showPage('bookAppointment')">
                        <span class="action-icon">üìÖ</span>
                        <div>
                            <h3>Book Appointment</h3>
                            <p>Schedule with doctors</p>
                        </div>
                    </div>
                    <div class="action-btn" onclick="showPage('appointments')">
                        <span class="action-icon">üìã</span>
                        <div>
                            <h3>My Appointments</h3>
                            <p>View & manage bookings</p>
                        </div>
                    </div>
                    <div class="action-btn" onclick="showPage('profile')">
                        <span class="action-icon">üë§</span>
                        <div>
                            <h3>My Profile</h3>
                            <p>Medical records & metrics</p>
                        </div>
                    </div>
                    <div class="action-btn" onclick="showPage('beds')">
                        <span class="action-icon">üõèÔ∏è</span>
                        <div>
                            <h3>Bed Availability</h3>
                            <p>Check available beds</p>
                        </div>
                    </div>
                    <div class="action-btn" onclick="showPage('aiDashboard')">
                        <span class="action-icon">ü§ñ</span>
                        <div>
                            <h3>AI Insights</h3>
                            <p>Health predictions</p>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h2>üîî Upcoming Appointments</h2>
                    </div>
                    <div class="card-body" id="upcomingAppointments">
                        <p>No upcoming appointments. <a onclick="showPage('bookAppointment')">Book one now!</a></p>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h2>üí° Health Tips</h2>
                    </div>
                    <div class="card-body">
                        <ul style="list-style: none; padding: 0;">
                            <li style="padding: var(--spacing-md); margin-bottom: var(--spacing-sm); background-color: var(--light-bg); border-radius: var(--border-radius); border-left: 4px solid var(--success-color);">‚úÖ Stay hydrated - Drink 8 glasses of water daily</li>
                            <li style="padding: var(--spacing-md); margin-bottom: var(--spacing-sm); background-color: var(--light-bg); border-radius: var(--border-radius); border-left: 4px solid var(--success-color);">‚úÖ Exercise - 30 minutes of physical activity</li>
                            <li style="padding: var(--spacing-md); margin-bottom: var(--spacing-sm); background-color: var(--light-bg); border-radius: var(--border-radius); border-left: 4px solid var(--success-color);">‚úÖ Sleep - 7-8 hours of quality rest</li>
                            <li style="padding: var(--spacing-md); margin-bottom: var(--spacing-sm); background-color: var(--light-bg); border-radius: var(--border-radius); border-left: 4px solid var(--success-color);">‚úÖ Nutrition - Include fruits & vegetables</li>
                            <li style="padding: var(--spacing-md); background-color: var(--light-bg); border-radius: var(--border-radius); border-left: 4px solid var(--success-color);">‚úÖ Checkups - Regular health monitoring</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Doctor Dashboard -->
            <div id="doctorDashboard" class="hidden">
                <div class="welcome-section">
                    <h1>Welcome, Dr. <span id="doctorName"></span>! üë®‚Äç‚öïÔ∏è</h1>
                    <p>Doctor Dashboard - Enhanced Management System</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-icon">üìÖ</span>
                        <h3>Today's Appointments</h3>
                        <p class="stat-value" id="todayAppointments">0</p>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">üë•</span>
                        <h3>Total Patients</h3>
                        <p class="stat-value" id="totalPatients">0</p>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">‚úÖ</span>
                        <h3>Completed</h3>
                        <p class="stat-value" id="completedAppointments">0</p>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">‚è≥</span>
                        <h3>Pending Uploads</h3>
                        <p class="stat-value" id="pendingUploads">0</p>
                    </div>
                </div>

                <div class="quick-actions">
                    <div class="action-btn" onclick="showPage('appointments')">
                        <span class="action-icon">üìã</span>
                        <div>
                            <h3>My Appointments</h3>
                            <p>Manage bookings & reports</p>
                        </div>
                    </div>
                    <div class="action-btn" onclick="showPage('beds')">
                        <span class="action-icon">üõèÔ∏è</span>
                        <div>
                            <h3>Bed Management</h3>
                            <p>Assign/Release beds</p>
                        </div>
                    </div>
                    <div class="action-btn" onclick="showPage('aiDashboard')">
                        <span class="action-icon">ü§ñ</span>
                        <div>
                            <h3>AI Analytics</h3>
                            <p>Doctor-only insights</p>
                        </div>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h2>üìÖ Upcoming Appointments</h2>
                    </div>
                    <div class="card-body" id="doctorUpcomingAppointments">
                        <p>No upcoming appointments today</p>
                    </div>
                </div>
            </div>

            <!-- Book Appointment Page (FEATURE 1: SLOT-BASED) -->
            <div id="bookAppointment" class="hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>üìÖ Book an Appointment - Slot Based</h2>
                    </div>
                    <div class="card-body">
                        <div id="bookAppointmentError" class="alert alert-danger"></div>
                        <div id="bookAppointmentSuccess" class="alert alert-success"></div>

                        <form onsubmit="handleBookAppointment(event)">
                            <div class="form-group">
                                <label>Select Doctor</label>
                                <select id="selectDoctor" onchange="loadDoctorSlots()" required>
                                    <option value="">-- Choose a doctor --</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>üóìÔ∏è Select Date (Within 15 Days)</label>
                                <input type="date" id="appointmentDate" onchange="loadDoctorSlots()" required>
                            </div>

                            <div class="form-group">
                                <label>‚è∞ Available Slots for Selected Doctor</label>
                                <div class="slots-container" id="slotsContainer">
                                    <p style="grid-column: 1/-1; text-align: center;">Select a doctor and date first</p>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Reason for Visit</label>
                                <textarea id="appointmentReason" placeholder="Describe your symptoms or reason for visit" required></textarea>
                            </div>

                            <div class="alert alert-info">
                                <strong>‚ÑπÔ∏è Note:</strong> Appointment slots are fixed by your doctor based on their availability. You cannot select custom time. Time is locked once booked.
                            </div>

                            <button type="submit" class="btn btn-primary btn-block">Confirm Booking</button>
                        </form>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <h2>Available Doctors</h2>
                    </div>
                    <div class="card-body" id="availableDoctors">
                        <p>Loading doctors...</p>
                    </div>
                </div>
            </div>

            <!-- Appointments List Page (FEATURE 2: ENHANCED) -->
            <div id="appointments" class="hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>üìÖ Your Appointments</h2>
                        <div style="margin-top: var(--spacing-md); display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                            <button class="btn btn-secondary btn-sm" onclick="filterAppointments('all')">All</button>
                            <button class="btn btn-secondary btn-sm" onclick="filterAppointments('SCHEDULED')">Scheduled</button>
                            <button class="btn btn-secondary btn-sm" onclick="filterAppointments('COMPLETED')">Completed</button>
                            <button class="btn btn-secondary btn-sm" onclick="filterAppointments('CANCELLED')">Cancelled</button>
                        </div>
                    </div>
                    <div class="card-body" id="appointmentsList">
                        <p>No appointments found</p>
                    </div>
                </div>
            </div>

            <!-- Profile Page (FEATURE 3: ENHANCED WITH HEALTH METRICS) -->
            <div id="profile" class="hidden">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showProfileTab('medical-info')">Medical Info</button>
                    <button class="tab-btn" onclick="showProfileTab('health-metrics')">Health Metrics</button>
                    <button class="tab-btn" onclick="showProfileTab('medical-records')">Medical History</button>
                </div>

                <!-- Medical Info Tab -->
                <div id="medical-info-tab" class="tab-content show">
                    <div class="card">
                        <div class="card-header">
                            <h2>üìã Medical Information</h2>
                        </div>
                        <div class="card-body">
                            <form onsubmit="handleUpdateProfile(event)">
                                <div class="grid-2">
                                    <div class="form-group">
                                        <label>Blood Type</label>
                                        <input type="text" id="bloodType" placeholder="O+, A-, B+, AB+">
                                    </div>
                                    <div class="form-group">
                                        <label>Height (cm)</label>
                                        <input type="number" id="height" placeholder="170">
                                    </div>
                                    <div class="form-group">
                                        <label>Weight (kg)</label>
                                        <input type="number" id="weight" placeholder="70">
                                    </div>
                                    <div class="form-group">
                                        <label>Emergency Contact</label>
                                        <input type="tel" id="emergencyContact" placeholder="Phone number">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Known Allergies</label>
                                    <textarea id="allergies" placeholder="List any known allergies (e.g., Penicillin, Peanuts)"></textarea>
                                </div>

                                <div class="form-group">
                                    <label>Chronic Conditions/Medical History</label>
                                    <textarea id="medicalHistory" placeholder="Chronic diseases, previous surgeries, current medications"></textarea>
                                </div>

                                <div class="form-group">
                                    <label>Insurance ID</label>
                                    <input type="text" id="insuranceId" placeholder="Insurance policy number">
                                </div>

                                <button type="submit" class="btn btn-primary">Save Medical Information</button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Health Metrics Tab -->
                <div id="health-metrics-tab" class="tab-content hidden">
                    <div class="card">
                        <div class="card-header">
                            <h2>üíì Health Metrics</h2>
                        </div>
                        <div class="card-body">
                            <form onsubmit="handleUpdateHealthMetrics(event)">
                                <div class="health-metrics">
                                    <div class="metric-card">
                                        <div class="metric-label">Blood Pressure</div>
                                        <input type="text" id="bloodPressure" placeholder="120/80" style="text-align: center; font-weight: bold; margin-bottom: var(--spacing-md);">
                                        <div class="metric-unit">mmHg</div>
                                    </div>

                                    <div class="metric-card">
                                        <div class="metric-label">Heart Rate</div>
                                        <input type="number" id="heartRate" placeholder="72" style="text-align: center; font-weight: bold; margin-bottom: var(--spacing-md);">
                                        <div class="metric-unit">bpm</div>
                                    </div>

                                    <div class="metric-card">
                                        <div class="metric-label">BMI</div>
                                        <input type="number" id="bmi" placeholder="24.2" step="0.1" style="text-align: center; font-weight: bold; margin-bottom: var(--spacing-md);">
                                        <div class="metric-unit">kg/m¬≤</div>
                                    </div>

                                    <div class="metric-card">
                                        <div class="metric-label">Temperature</div>
                                        <input type="number" id="temperature" placeholder="37" step="0.1" style="text-align: center; font-weight: bold; margin-bottom: var(--spacing-md);">
                                        <div class="metric-unit">¬∞C</div>
                                    </div>

                                    <div class="metric-card">
                                        <div class="metric-label">Glucose Level</div>
                                        <input type="number" id="glucose" placeholder="100" style="text-align: center; font-weight: bold; margin-bottom: var(--spacing-md);">
                                        <div class="metric-unit">mg/dL</div>
                                    </div>

                                    <div class="metric-card">
                                        <div class="metric-label">Oxygen Saturation</div>
                                        <input type="number" id="oxygenSat" placeholder="98" style="text-align: center; font-weight: bold; margin-bottom: var(--spacing-md);">
                                        <div class="metric-unit">%</div>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary btn-block mt-3">Update Health Metrics</button>
                            </form>

                            <div class="card mt-3">
                                <div class="card-header">
                                    <h3>üìä Current Health Status</h3>
                                </div>
                                <div class="card-body" id="healthStatus">
                                    <p>No metrics recorded yet. Add your metrics above.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Medical Records Tab -->
                <div id="medical-records-tab" class="tab-content hidden">
                    <div class="card">
                        <div class="card-header">
                            <h2>üìÑ Medical Records & History</h2>
                        </div>
                        <div class="card-body" id="medicalRecordsContainer">
                            <p>No medical records found. Your doctor will add records after consultation.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bed Management Page -->
            <div id="beds" class="hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>üõèÔ∏è Bed Management System</h2>
                        <button class="btn btn-secondary btn-sm" onclick="loadBeds()" style="margin-top: var(--spacing-md);">üîÑ Refresh</button>
                    </div>
                    <div class="card-body">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <span class="stat-icon">üõèÔ∏è</span>
                                <h3>Total Beds</h3>
                                <p class="stat-value" id="totalBeds">8</p>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon">üë•</span>
                                <h3>Occupied</h3>
                                <p class="stat-value" id="occupiedBeds">1</p>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon">‚úÖ</span>
                                <h3>Available</h3>
                                <p class="stat-value" id="availableBeds">7</p>
                            </div>
                            <div class="stat-card">
                                <span class="stat-icon">üìä</span>
                                <h3>Occupancy Rate</h3>
                                <p class="stat-value" id="occupancyRate">12.5%</p>
                            </div>
                        </div>

                        <div style="margin-top: var(--spacing-lg);">
                            <div class="form-group">
                                <label>Search Bed:</label>
                                <input type="text" id="bedSearch" placeholder="Bed number or patient name..." onkeyup="filterBeds()">
                            </div>
                            <div class="form-group">
                                <label>Filter by Ward:</label>
                                <select id="bedWardFilter" onchange="filterBeds()">
                                    <option value="">All Wards</option>
                                    <option value="ICU">ICU</option>
                                    <option value="General Ward">General Ward</option>
                                    <option value="Pediatrics">Pediatrics</option>
                                    <option value="Cardiology">Cardiology</option>
                                    <option value="Surgery">Surgery</option>
                                    <option value="Orthopedics">Orthopedics</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid-3" id="bedsGrid">
                            <p>Loading beds...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Dashboard (FEATURE 4: ROLE-BASED ACCESS) -->
            <div id="aiDashboard" class="hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>ü§ñ AI Analytics & Predictions Dashboard <span class="analytics-access-badge" id="accessBadge" style="display: inline;"></span></h2>
                        <button class="btn btn-secondary btn-sm" onclick="loadAIData()" style="margin-top: var(--spacing-md);">üîÑ Refresh Data</button>
                    </div>
                    <div class="card-body">
                        <!-- Tabs -->
                        <div class="tabs">
                            <button class="tab-btn active" onclick="showTab('overview')">üìä Overview</button>
                            <button class="tab-btn" id="admissionsTabBtn" onclick="showTab('admissions')">üìà Admissions</button>
                            <button class="tab-btn" id="alertsTabBtn" onclick="showTab('alerts')">üö® Alerts</button>
                            <button class="tab-btn" id="readmissionTabBtn" onclick="showTab('readmission')">‚öïÔ∏è Readmission</button>
                            <button class="tab-btn" id="departmentsTabBtn" onclick="showTab('departments')">üè¢ Departments</button>
                        </div>

                        <!-- Overview Tab -->
                        <div id="overviewTab" class="tab-content show">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <span class="stat-icon">üë•</span>
                                    <h3>Total Patients</h3>
                                    <p class="stat-value">456</p>
                                    <p style="margin: var(--spacing-xs) 0; color: white; opacity: 0.9;">Active: 142</p>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-icon">üìä</span>
                                    <h3>Bed Utilization</h3>
                                    <p class="stat-value">87%</p>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-icon">‚è±Ô∏è</span>
                                    <h3>Avg Wait Time</h3>
                                    <p class="stat-value">18 min</p>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-icon">‚≠ê</span>
                                    <h3>Patient Satisfaction</h3>
                                    <p class="stat-value">4.6/5</p>
                                </div>
                            </div>

                            <div class="card mt-3">
                                <div class="card-header">
                                    <h2>üö® Risk Alerts (Real-Time Monitoring)</h2>
                                </div>
                                <div class="card-body" id="riskAlertsContainer">
                                    <div style="padding: var(--spacing-lg); border-left: 4px solid var(--danger-color); background-color: #fadbd8; border-radius: var(--border-radius); margin-bottom: var(--spacing-md);">
                                        <h4 style="margin: 0 0 var(--spacing-sm) 0;">üö® High Admission Rate Detected</h4>
                                        <p style="margin: var(--spacing-xs) 0; font-size: var(--font-sm);">Predicted 25% increase in admissions next 3 days</p>
                                        <p style="margin: var(--spacing-xs) 0; font-size: var(--font-sm); color: var(--danger-color); font-weight: 600;">Action: Activate contingency staffing</p>
                                    </div>

                                    <div style="padding: var(--spacing-lg); border-left: 4px solid var(--warning-color); background-color: #fdebd0; border-radius: var(--border-radius); margin-bottom: var(--spacing-md);">
                                        <h4 style="margin: 0 0 var(--spacing-sm) 0;">‚ö†Ô∏è ICU Occupancy Trending High</h4>
                                        <p style="margin: var(--spacing-xs) 0; font-size: var(--font-sm);">ICU occupancy predicted to reach 85% by tomorrow</p>
                                        <p style="margin: var(--spacing-xs) 0; font-size: var(--font-sm); color: var(--warning-color); font-weight: 600;">Action: Prepare additional ICU beds</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Admissions Tab (DOCTOR RESTRICTED) -->
                        <div id="admissionsTab" class="tab-content">
                            <div id="admissionsContent">
                                <div class="card">
                                    <div class="card-header">
                                        <h2>üìà 7-Day Admission Forecast</h2>
                                    </div>
                                    <div class="card-body">
                                        <table id="admissionsTable">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Predicted</th>
                                                    <th>Confidence</th>
                                                    <th>Risk Level</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admissionsTableBody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alerts Tab (DOCTOR RESTRICTED) -->
                        <div id="alertsTab" class="tab-content">
                            <div id="alertsContent">
                                <div class="card">
                                    <div class="card-header">
                                        <h2>üö® All Critical Alerts</h2>
                                    </div>
                                    <div class="card-body" id="allAlertsContainer">
                                        <p>No critical alerts at this time</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Readmission Tab (DOCTOR RESTRICTED) -->
                        <div id="readmissionTab" class="tab-content">
                            <div id="readmissionContent">
                                <div class="card">
                                    <div class="card-header">
                                        <h2>‚öïÔ∏è Readmission Risk Assessment</h2>
                                    </div>
                                    <div class="card-body">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Patient</th>
                                                    <th>Risk Score</th>
                                                    <th>Level</th>
                                                </tr>
                                            </thead>
                                            <tbody id="readmissionTableBody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Departments Tab (DOCTOR RESTRICTED) -->
                        <div id="departmentsTab" class="tab-content">
                            <div id="departmentsContent">
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h3 style="margin-top: 0;">Cardiology</h3>
                                        <p style="margin: var(--spacing-sm) 0; font-size: var(--font-sm);">Patients: 45 | Success: 96%</p>
                                    </div>
                                    <div class="stat-card">
                                        <h3 style="margin-top: 0;">Neurology</h3>
                                        <p style="margin: var(--spacing-sm) 0; font-size: var(--font-sm);">Patients: 32 | Success: 94%</p>
                                    </div>
                                    <div class="stat-card">
                                        <h3 style="margin-top: 0;">Orthopedics</h3>
                                        <p style="margin: var(--spacing-sm) 0; font-size: var(--font-sm);">Patients: 58 | Success: 98%</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Patient Restricted Message -->
                        <div id="patientRestrictedMessage" class="restricted-content hidden">
                            <h4>üîí Doctor-Only Data</h4>
                            <p>This section contains sensitive clinical data accessible only to healthcare professionals. You can view general health insights and your personal health metrics in your profile.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->

    <!-- Appointment Details Modal -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Appointment Details</h2>
                <button class="modal-close" onclick="closeModal('appointmentModal')">‚úï</button>
            </div>
            <div class="card-body" id="appointmentModalContent">
            </div>
        </div>
    </div>

    <!-- Upload Report Modal (for doctors) -->
    <div id="uploadReportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Upload Meeting Report</h2>
                <button class="modal-close" onclick="closeModal('uploadReportModal')">‚úï</button>
            </div>
            <form onsubmit="handleUploadReport(event)" style="padding: var(--spacing-lg) 0;">
                <div class="form-group">
                    <label>Meeting Status</label>
                    <select id="meetingStatus" required>
                        <option value="">Select status</option>
                        <option value="COMPLETED">Completed Successfully</option>
                        <option value="PARTIAL">Partially Completed</option>
                        <option value="RESCHEDULED">Rescheduled</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Diagnosis</label>
                    <textarea id="diagnosisReport" placeholder="Medical findings and diagnosis" required></textarea>
                </div>

                <div class="form-group">
                    <label>Treatment Plan</label>
                    <textarea id="treatmentPlan" placeholder="Prescribed treatment and medications" required></textarea>
                </div>

                <div class="form-group">
                    <label>Recommendations</label>
                    <textarea id="recommendations" placeholder="Follow-up and lifestyle recommendations"></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-block">Upload Report</button>
            </form>
        </div>
    </div>

    <!-- Reschedule Modal -->
    <div id="rescheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reschedule Appointment</h2>
                <button class="modal-close" onclick="closeModal('rescheduleModal')">‚úï</button>
            </div>
            <form onsubmit="handleReschedule(event)" style="padding: var(--spacing-lg) 0;">
                <div class="form-group">
                    <label>Select New Date (Within 15 Days)</label>
                    <input type="date" id="rescheduleDate" required>
                </div>

                <div class="form-group">
                    <label>Available Time Slots</label>
                    <div class="slots-container" id="rescheduleSlots">
                        <p style="grid-column: 1/-1; text-align: center;">Select date first</p>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-block">Confirm Reschedule</button>
            </form>
        </div>
    </div>

    <script>
        // ========================================
        // APPLICATION STATE
        // ========================================
        let appState = {
            currentUser: null,
            isLoggedIn: false,
            currentPage: null,
            appointments: [],
            doctors: [],
            beds: [],
            allBeds: [],
            selectedSlot: null,
            rescheduleAppointmentId: null,
            uploadReportAppointmentId: null,
            healthMetrics: {}
        };

        // Mock Doctors Data
        const mockDoctors = [
            { 
                id: 1, 
                name: 'Dr. Priya Patel', 
                specialization: 'Cardiology', 
                experience_years: 8, 
                consultation_fee: 500,
                slots: ['09:00', '09:30', '10:00', '10:30', '14:00', '14:30', '15:00']
            },
            { 
                id: 2, 
                name: 'Dr. Rajesh Verma', 
                specialization: 'Neurology', 
                experience_years: 12, 
                consultation_fee: 600,
                slots: ['10:00', '10:30', '11:00', '15:00', '15:30', '16:00']
            },
            { 
                id: 3, 
                name: 'Dr. Anjali Singh', 
                specialization: 'Pediatrics', 
                experience_years: 7, 
                consultation_fee: 400,
                slots: ['08:00', '08:30', '09:00', '13:00', '13:30', '14:00']
            },
            { 
                id: 4, 
                name: 'Dr. Vikram Kumar', 
                specialization: 'Surgery', 
                experience_years: 15, 
                consultation_fee: 700,
                slots: ['11:00', '11:30', '12:00', '16:00', '16:30']
            },
        ];

        // Mock Beds Data
        const mockBeds = [
            { id: 1, bed_number: 'ICU-101', ward: 'ICU', bed_type: 'ICU', priority: 'Critical', status: 'AVAILABLE' },
            { id: 2, bed_number: 'ICU-102', ward: 'ICU', bed_type: 'ICU', priority: 'Critical', status: 'AVAILABLE' },
            { id: 3, bed_number: 'GW-201', ward: 'General Ward', bed_type: 'Standard', priority: 'Standard', status: 'AVAILABLE' },
            { id: 4, bed_number: 'GW-202', ward: 'General Ward', bed_type: 'Standard', priority: 'Standard', status: 'OCCUPIED', patient_name: 'Priya Sharma' },
            { id: 5, bed_number: 'PED-301', ward: 'Pediatrics', bed_type: 'Pediatric', priority: 'Standard', status: 'AVAILABLE' },
            { id: 6, bed_number: 'CARD-401', ward: 'Cardiology', bed_type: 'Standard', priority: 'High', status: 'AVAILABLE' },
            { id: 7, bed_number: 'SURG-501', ward: 'Surgery', bed_type: 'Post-Op', priority: 'High', status: 'AVAILABLE' },
            { id: 8, bed_number: 'ORTHO-601', ward: 'Orthopedics', bed_type: 'Standard', priority: 'Standard', status: 'AVAILABLE' },
        ];

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        function showAlert(elementId, message, type = 'danger') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.add('show', `alert-${type}`);
            setTimeout(() => {
                element.classList.remove('show');
            }, 5000);
        }

        function getDateOnly(date) {
            return new Date(date).toLocaleDateString('en-CA');
        }

        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }

        function isDateWithin15Days(date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const selectedDate = new Date(date);
            selectedDate.setHours(0, 0, 0, 0);
            const diffTime = selectedDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays >= 0 && diffDays <= 15;
        }

        function setDateConstraints() {
            const dateInput = document.getElementById('appointmentDate');
            const today = new Date().toISOString().split('T')[0];
            const maxDate = addDays(new Date(), 15).toISOString().split('T')[0];
            dateInput.min = today;
            dateInput.max = maxDate;
        }

        // ========================================
        // AUTH FUNCTIONS
        // ========================================
        function showLogin() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('registerPage').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.remove('hidden');
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const user = {
                id: Math.floor(Math.random() * 1000),
                name: email.split('@')[0],
                email: email,
                role: email.includes('doctor') ? 'DOCTOR' : 'PATIENT'
            };

            appState.currentUser = user;
            appState.isLoggedIn = true;
            localStorage.setItem('user', JSON.stringify(user));

            showMainContent();
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const role = document.getElementById('registerRole').value;

            if (password !== document.getElementById('registerConfirm').value) {
                showAlert('registerError', '‚ùå Passwords do not match', 'danger');
                return;
            }

            const user = {
                id: Math.floor(Math.random() * 1000),
                name: name,
                email: email,
                role: role
            };

            appState.currentUser = user;
            appState.isLoggedIn = true;
            localStorage.setItem('user', JSON.stringify(user));

            showMainContent();
        }

        function logout() {
            appState.currentUser = null;
            appState.isLoggedIn = false;
            localStorage.removeItem('user');
            document.getElementById('mainContent').classList.remove('show');
            document.getElementById('header').classList.remove('show');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('registerPage').classList.add('hidden');
        }

        // ========================================
        // PAGE NAVIGATION
        // ========================================
        function showMainContent() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('mainContent').classList.add('show');
            document.getElementById('header').classList.add('show');

            document.getElementById('userName').textContent = appState.currentUser.name;
            document.getElementById('userRole').textContent = appState.currentUser.role;

            const headerNav = document.getElementById('headerNav');
            headerNav.innerHTML = '';
            if (appState.currentUser.role === 'PATIENT') {
                headerNav.innerHTML = `
                    <a onclick="showPage('patientDashboard')">Dashboard</a>
                    <a onclick="showPage('bookAppointment')">Book Appointment</a>
                    <a onclick="showPage('appointments')">My Appointments</a>
                    <a onclick="showPage('profile')">My Profile</a>
                    <a onclick="showPage('beds')">Bed Availability</a>
                    <a onclick="showPage('aiDashboard')">AI Insights</a>
                `;
                showPage('patientDashboard');
            } else if (appState.currentUser.role === 'DOCTOR') {
                headerNav.innerHTML = `
                    <a onclick="showPage('doctorDashboard')">Dashboard</a>
                    <a onclick="showPage('appointments')">My Appointments</a>
                    <a onclick="showPage('beds')">Bed Management</a>
                    <a onclick="showPage('aiDashboard')">AI Analytics</a>
                `;
                showPage('doctorDashboard');
            }

            setDateConstraints();
        }

        function showPage(pageName) {
            const pages = [
                'patientDashboard', 'doctorDashboard', 'bookAppointment', 
                'appointments', 'profile', 'beds', 'aiDashboard'
            ];
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });

            document.getElementById(pageName).classList.remove('hidden');
            appState.currentPage = pageName;

            if (pageName === 'patientDashboard') {
                document.getElementById('patientName').textContent = appState.currentUser.name;
                loadAppointments();
            } else if (pageName === 'doctorDashboard') {
                document.getElementById('doctorName').textContent = appState.currentUser.name;
                loadDoctorStats();
            } else if (pageName === 'bookAppointment') {
                loadDoctors();
                setDateConstraints();
            } else if (pageName === 'appointments') {
                loadAppointments();
            } else if (pageName === 'beds') {
                loadBeds();
            } else if (pageName === 'aiDashboard') {
                loadAIData();
            }

            window.scrollTo(0, 0);
        }

        // ========================================
        // FEATURE 1: SLOT-BASED APPOINTMENT BOOKING
        // ========================================
        function loadDoctors() {
            appState.doctors = mockDoctors;
            const selectDoctor = document.getElementById('selectDoctor');
            selectDoctor.innerHTML = '<option value="">-- Choose a doctor --</option>';
            mockDoctors.forEach(doctor => {
                const option = document.createElement('option');
                option.value = doctor.id;
                option.textContent = `Dr. ${doctor.name} - ${doctor.specialization} (‚Çπ${doctor.consultation_fee})`;
                selectDoctor.appendChild(option);
            });

            const availableDoctors = document.getElementById('availableDoctors');
            availableDoctors.innerHTML = '';
            mockDoctors.forEach(doctor => {
                const doctorCard = document.createElement('div');
                doctorCard.style.cssText = 'background-color: var(--light-bg); border-left: 4px solid var(--primary-color); padding: var(--spacing-lg); margin-bottom: var(--spacing-md); border-radius: var(--border-radius);';
                doctorCard.innerHTML = `
                    <h4 style="margin: 0 0 var(--spacing-sm) 0; color: var(--primary-color);">Dr. ${doctor.name}</h4>
                    <p style="margin: 0; font-size: var(--font-sm);"><strong>Specialization:</strong> ${doctor.specialization}</p>
                    <p style="margin: 0; font-size: var(--font-sm);"><strong>Experience:</strong> ${doctor.experience_years} years</p>
                    <p style="margin: 0; font-size: var(--font-sm);"><strong>Consultation Fee:</strong> ‚Çπ${doctor.consultation_fee}</p>
                    <p style="margin: var(--spacing-sm) 0 0 0; font-size: var(--font-sm);"><strong>Available Slots:</strong> ${doctor.slots.join(', ')}</p>
                `;
                availableDoctors.appendChild(doctorCard);
            });
        }

        function loadDoctorSlots() {
            const doctorId = document.getElementById('selectDoctor').value;
            const appointmentDate = document.getElementById('appointmentDate').value;

            const slotsContainer = document.getElementById('slotsContainer');
            slotsContainer.innerHTML = '';

            if (!doctorId || !appointmentDate) {
                slotsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">Select a doctor and date first</p>';
                return;
            }

            if (!isDateWithin15Days(appointmentDate)) {
                slotsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--danger-color);">‚ùå Can only book appointments within 15 days</p>';
                return;
            }

            const doctor = mockDoctors.find(d => d.id == doctorId);
            if (!doctor) return;

            doctor.slots.forEach(slot => {
                const slotBtn = document.createElement('button');
                slotBtn.type = 'button';
                slotBtn.className = 'slot-btn';
                slotBtn.textContent = slot;
                slotBtn.onclick = (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.slot-btn').forEach(btn => btn.classList.remove('selected'));
                    slotBtn.classList.add('selected');
                    appState.selectedSlot = slot;
                };
                slotsContainer.appendChild(slotBtn);
            });
        }

        function handleBookAppointment(e) {
            e.preventDefault();
            const doctorId = document.getElementById('selectDoctor').value;
            const appointmentDate = document.getElementById('appointmentDate').value;
            const reason = document.getElementById('appointmentReason').value;

            if (!doctorId || !appointmentDate || !appState.selectedSlot || !reason) {
                showAlert('bookAppointmentError', '‚ùå Please select all required fields', 'danger');
                return;
            }

            if (!isDateWithin15Days(appointmentDate)) {
                showAlert('bookAppointmentError', '‚ùå Can only book within 15 days', 'danger');
                return;
            }

            const doctor = mockDoctors.find(d => d.id == doctorId);
            const appointment = {
                id: Math.floor(Math.random() * 10000),
                doctor_id: doctorId,
                doctor_name: `Dr. ${doctor.name}`,
                patient_id: appState.currentUser.id,
                patient_name: appState.currentUser.name,
                appointment_date: `${appointmentDate} ${appState.selectedSlot}:00`,
                status: 'SCHEDULED',
                reason: reason,
                notification_sent: true,
                prior_notification: '24 hours before appointment',
                report_uploaded: false,
                meeting_report: null
            };

            appState.appointments.push(appointment);
            showAlert('bookAppointmentSuccess', '‚úÖ Appointment booked successfully! You will receive a notification 24 hours before the appointment.', 'success');
            
            setTimeout(() => {
                document.getElementById('selectDoctor').value = '';
                document.getElementById('appointmentDate').value = '';
                document.getElementById('appointmentReason').value = '';
                appState.selectedSlot = null;
                document.getElementById('slotsContainer').innerHTML = '<p style="grid-column: 1/-1; text-align: center;">Select a doctor and date first</p>';
            }, 2000);
        }

        // ========================================
        // FEATURE 2: APPOINTMENTS WITH NOTIFICATIONS & REPORTS
        // ========================================
        function loadAppointments() {
            const appointmentsList = document.getElementById('appointmentsList');
            appointmentsList.innerHTML = '';

            if (appState.appointments.length === 0) {
                appointmentsList.innerHTML = appState.currentUser.role === 'PATIENT' 
                    ? '<p>No appointments found. <a onclick="showPage(\'bookAppointment\')">Book one now!</a></p>'
                    : '<p>No appointments scheduled</p>';
            } else {
                appState.appointments.forEach(apt => {
                    const aptDiv = document.createElement('div');
                    aptDiv.className = `appointment-card ${apt.status.toLowerCase()}`;
                    
                    let actions = '';
                    if (apt.status === 'SCHEDULED') {
                        if (appState.currentUser.role === 'PATIENT') {
                            actions = `
                                <button class="btn btn-secondary btn-sm" onclick="openRescheduleModal(${apt.id})">üìÖ Reschedule</button>
                                <button class="btn btn-danger btn-sm" onclick="cancelAppointment(${apt.id})">‚ùå Cancel</button>
                            `;
                        } else {
                            actions = `
                                <button class="btn btn-success btn-sm" onclick="openUploadReportModal(${apt.id})">üìÑ Upload Report</button>
                            `;
                        }
                    } else if (apt.status === 'COMPLETED') {
                        if (appState.currentUser.role === 'PATIENT' && apt.report_uploaded) {
                            actions = `
                                <button class="btn btn-secondary btn-sm" onclick="viewMeetingReport(${apt.id})">üëÅÔ∏è View Report</button>
                            `;
                        }
                    }

                    const appointmentDate = new Date(apt.appointment_date);
                    const dateStr = appointmentDate.toLocaleDateString();
                    const timeStr = appointmentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    aptDiv.innerHTML = `
                        <div class="appointment-header">
                            <div>
                                <h4>${appState.currentUser.role === 'PATIENT' ? apt.doctor_name : apt.patient_name}</h4>
                                <span class="status-badge ${apt.status.toLowerCase()}">${apt.status}</span>
                            </div>
                        </div>
                        
                        ${apt.notification_sent && apt.status === 'SCHEDULED' ? `
                            <div class="notification-banner">
                                <span class="notification-icon">üîî</span>
                                <div class="notification-content">
                                    <h4>Appointment Reminder</h4>
                                    <p>You will receive a notification ${apt.prior_notification}</p>
                                </div>
                            </div>
                        ` : ''}

                        <div class="appointment-details">
                            <div class="detail-row">
                                <span class="detail-label">Date & Time:</span>
                                <span>${dateStr} at ${timeStr}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Reason:</span>
                                <span>${apt.reason}</span>
                            </div>
                            ${apt.report_uploaded ? `
                                <div class="detail-row">
                                    <span class="detail-label">Report Status:</span>
                                    <span style="color: var(--success-color); font-weight: 600;">‚úÖ Report Uploaded</span>
                                </div>
                            ` : ''}
                        </div>

                        <div class="appointment-actions">
                            ${actions}
                            <button class="btn btn-secondary btn-sm" onclick="viewAppointmentDetails(${apt.id})">üëÅÔ∏è View Details</button>
                        </div>
                    `;
                    appointmentsList.appendChild(aptDiv);
                });
            }

            if (appState.currentUser.role === 'DOCTOR') {
                loadDoctorStats();
            }

            if (appState.currentUser.role === 'PATIENT') {
                const upcomingAppointments = document.getElementById('upcomingAppointments');
                if (upcomingAppointments) {
                    upcomingAppointments.innerHTML = '';
                    appState.appointments.filter(apt => apt.status === 'SCHEDULED').forEach(apt => {
                        const aptDiv = document.createElement('div');
                        aptDiv.className = 'appointment-card';
                        const appointmentDate = new Date(apt.appointment_date);
                        const dateStr = appointmentDate.toLocaleDateString();
                        const timeStr = appointmentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        
                        aptDiv.innerHTML = `
                            <div class="appointment-header">
                                <div>
                                    <h4>${apt.doctor_name}</h4>
                                    <p style="margin: 0; font-size: var(--font-sm);">${dateStr} at ${timeStr}</p>
                                    <p style="margin: 0; font-size: var(--font-sm);">${apt.reason}</p>
                                </div>
                            </div>
                            <div class="notification-banner">
                                <span class="notification-icon">üîî</span>
                                <div class="notification-content">
                                    <p style="margin: 0;">Notification will be sent ${apt.prior_notification}</p>
                                </div>
                            </div>
                        `;
                        upcomingAppointments.appendChild(aptDiv);
                    });
                    if (appState.appointments.filter(apt => apt.status === 'SCHEDULED').length === 0) {
                        upcomingAppointments.innerHTML = '<p>No upcoming appointments. <a onclick="showPage(\'bookAppointment\')">Book one now!</a></p>';
                    }
                }
            }
        }

        function openUploadReportModal(appointmentId) {
            appState.uploadReportAppointmentId = appointmentId;
            document.getElementById('uploadReportModal').classList.add('show');
        }

        function handleUploadReport(e) {
            e.preventDefault();
            const apt = appState.appointments.find(a => a.id === appState.uploadReportAppointmentId);
            if (!apt) return;

            apt.status = 'COMPLETED';
            apt.report_uploaded = true;
            apt.meeting_report = {
                status: document.getElementById('meetingStatus').value,
                diagnosis: document.getElementById('diagnosisReport').value,
                treatment: document.getElementById('treatmentPlan').value,
                recommendations: document.getElementById('recommendations').value,
                uploadedAt: new Date().toLocaleString()
            };

            showAlert('uploadReportSuccess', '‚úÖ Report uploaded successfully!', 'success');
            closeModal('uploadReportModal');
            loadAppointments();
        }

        function openRescheduleModal(appointmentId) {
            appState.rescheduleAppointmentId = appointmentId;
            setDateConstraints();
            document.getElementById('rescheduleModal').classList.add('show');
        }

        function handleReschedule(e) {
            e.preventDefault();
            const apt = appState.appointments.find(a => a.id === appState.rescheduleAppointmentId);
            if (!apt || !appState.selectedSlot) {
                showAlert('rescheduleError', '‚ùå Please select a slot', 'danger');
                return;
            }

            const newDate = document.getElementById('rescheduleDate').value;
            apt.appointment_date = `${newDate} ${appState.selectedSlot}:00`;
            apt.status = 'SCHEDULED';

            showAlert('rescheduleSuccess', '‚úÖ Appointment rescheduled successfully!', 'success');
            closeModal('rescheduleModal');
            loadAppointments();
        }

        function cancelAppointment(id) {
            if (confirm('Are you sure you want to cancel this appointment?')) {
                const apt = appState.appointments.find(a => a.id === id);
                if (apt) {
                    apt.status = 'CANCELLED';
                    showAlert('cancelSuccess', '‚úÖ Appointment cancelled', 'success');
                    loadAppointments();
                }
            }
        }

        function filterAppointments(status) {
            const appointmentsList = document.getElementById('appointmentsList');
            appointmentsList.innerHTML = '';

            let filtered = status === 'all' ? appState.appointments : appState.appointments.filter(apt => apt.status === status);

            if (filtered.length === 0) {
                appointmentsList.innerHTML = '<p>No appointments found</p>';
            } else {
                filtered.forEach(apt => {
                    const aptDiv = document.createElement('div');
                    aptDiv.className = `appointment-card ${apt.status.toLowerCase()}`;
                    
                    const appointmentDate = new Date(apt.appointment_date);
                    const dateStr = appointmentDate.toLocaleDateString();
                    const timeStr = appointmentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    let actions = '';
                    if (apt.status === 'SCHEDULED') {
                        if (appState.currentUser.role === 'PATIENT') {
                            actions = `
                                <button class="btn btn-secondary btn-sm" onclick="openRescheduleModal(${apt.id})">üìÖ Reschedule</button>
                                <button class="btn btn-danger btn-sm" onclick="cancelAppointment(${apt.id})">‚ùå Cancel</button>
                            `;
                        } else {
                            actions = `
                                <button class="btn btn-success btn-sm" onclick="openUploadReportModal(${apt.id})">üìÑ Upload Report</button>
                            `;
                        }
                    } else if (apt.status === 'COMPLETED' && apt.report_uploaded) {
                        actions = `
                            <button class="btn btn-secondary btn-sm" onclick="viewMeetingReport(${apt.id})">üëÅÔ∏è View Report</button>
                        `;
                    }

                    aptDiv.innerHTML = `
                        <div class="appointment-header">
                            <div>
                                <h4>${appState.currentUser.role === 'PATIENT' ? apt.doctor_name : apt.patient_name}</h4>
                                <span class="status-badge ${apt.status.toLowerCase()}">${apt.status}</span>
                            </div>
                        </div>
                        
                        ${apt.notification_sent && apt.status === 'SCHEDULED' ? `
                            <div class="notification-banner">
                                <span class="notification-icon">üîî</span>
                                <div class="notification-content">
                                    <h4>Appointment Reminder</h4>
                                    <p>Notification will be sent ${apt.prior_notification}</p>
                                </div>
                            </div>
                        ` : ''}

                        <div class="appointment-details">
                            <div class="detail-row">
                                <span class="detail-label">Date & Time:</span>
                                <span>${dateStr} at ${timeStr}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Reason:</span>
                                <span>${apt.reason}</span>
                            </div>
                            ${apt.report_uploaded ? `
                                <div class="detail-row">
                                    <span class="detail-label">Report:</span>
                                    <span style="color: var(--success-color); font-weight: 600;">‚úÖ Report Uploaded</span>
                                </div>
                            ` : ''}
                        </div>

                        <div class="appointment-actions">
                            ${actions}
                            <button class="btn btn-secondary btn-sm" onclick="viewAppointmentDetails(${apt.id})">üëÅÔ∏è Details</button>
                        </div>
                    `;
                    appointmentsList.appendChild(aptDiv);
                });
            }
        }

        function viewAppointmentDetails(id) {
            const apt = appState.appointments.find(a => a.id === id);
            if (!apt) return;

            const appointmentDate = new Date(apt.appointment_date);
            const dateStr = appointmentDate.toLocaleDateString();
            const timeStr = appointmentDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            let reportContent = '';
            if (apt.report_uploaded && apt.meeting_report) {
                reportContent = `
                    <div style="background-color: var(--light-bg); padding: var(--spacing-lg); border-radius: var(--border-radius); margin-top: var(--spacing-lg);">
                        <h4 style="color: var(--success-color); margin-bottom: var(--spacing-md);">üìÑ Meeting Report</h4>
                        <div class="detail-row">
                            <span class="detail-label">Status:</span>
                            <span>${apt.meeting_report.status}</span>
                        </div>
                        <div style="margin-top: var(--spacing-md);">
                            <h5 style="margin-bottom: var(--spacing-sm);">Diagnosis:</h5>
                            <p style="margin: 0; font-size: var(--font-sm);">${apt.meeting_report.diagnosis}</p>
                        </div>
                        <div style="margin-top: var(--spacing-md);">
                            <h5 style="margin-bottom: var(--spacing-sm);">Treatment Plan:</h5>
                            <p style="margin: 0; font-size: var(--font-sm);">${apt.meeting_report.treatment}</p>
                        </div>
                        ${apt.meeting_report.recommendations ? `
                            <div style="margin-top: var(--spacing-md);">
                                <h5 style="margin-bottom: var(--spacing-sm);">Recommendations:</h5>
                                <p style="margin: 0; font-size: var(--font-sm);">${apt.meeting_report.recommendations}</p>
                            </div>
                        ` : ''}
                        <p style="margin-top: var(--spacing-md); margin-bottom: 0; font-size: var(--font-sm); color: #7f8c8d;">Uploaded: ${apt.meeting_report.uploadedAt}</p>
                    </div>
                `;
            }

            const content = `
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="status-badge ${apt.status.toLowerCase()}">${apt.status}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">${appState.currentUser.role === 'PATIENT' ? 'Doctor' : 'Patient'}:</span>
                    <span>${appState.currentUser.role === 'PATIENT' ? apt.doctor_name : apt.patient_name}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Date & Time:</span>
                    <span>${dateStr} at ${timeStr}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Reason:</span>
                    <span>${apt.reason}</span>
                </div>
                ${apt.notification_sent ? `
                    <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background-color: #e8f5e9; border-radius: var(--border-radius); border-left: 4px solid var(--success-color);">
                        <p style="margin: 0; font-size: var(--font-sm);"><strong>üîî Notification:</strong> ${apt.prior_notification}</p>
                    </div>
                ` : ''}
                ${reportContent}
            `;

            document.getElementById('appointmentModalContent').innerHTML = content;
            document.getElementById('appointmentModal').classList.add('show');
        }

        function viewMeetingReport(id) {
            viewAppointmentDetails(id);
        }

        // ========================================
        // FEATURE 3: ENHANCED PROFILE WITH HEALTH METRICS & MEDICAL RECORDS
        // ========================================
        function showProfileTab(tabName) {
            const tabs = ['medical-info-tab', 'health-metrics-tab', 'medical-records-tab'];
            tabs.forEach(tab => {
                document.getElementById(tab).classList.add('hidden');
            });
            document.getElementById(tabName + '-tab').classList.remove('hidden');

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function handleUpdateProfile(e) {
            e.preventDefault();
            showAlert('profileSuccess', '‚úÖ Medical information updated successfully!', 'success');
        }

        function handleUpdateHealthMetrics(e) {
            e.preventDefault();

            appState.healthMetrics = {
                bloodPressure: document.getElementById('bloodPressure').value,
                heartRate: document.getElementById('heartRate').value,
                bmi: document.getElementById('bmi').value,
                temperature: document.getElementById('temperature').value,
                glucose: document.getElementById('glucose').value,
                oxygenSat: document.getElementById('oxygenSat').value,
                lastUpdated: new Date().toLocaleString()
            };

            const healthStatus = document.getElementById('healthStatus');
            healthStatus.innerHTML = `
                <div style="background-color: var(--light-bg); padding: var(--spacing-lg); border-radius: var(--border-radius);">
                    <h4 style="color: var(--success-color); margin-bottom: var(--spacing-md);">‚úÖ Health Metrics Updated</h4>
                    <div class="grid-3">
                        <div>
                            <p style="margin: 0; font-size: var(--font-sm); color: var(--primary-color); font-weight: 600;">Blood Pressure</p>
                            <p style="margin: var(--spacing-xs) 0 0 0; font-size: 18px; font-weight: bold;">${appState.healthMetrics.bloodPressure} mmHg</p>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: var(--font-sm); color: var(--primary-color); font-weight: 600;">Heart Rate</p>
                            <p style="margin: var(--spacing-xs) 0 0 0; font-size: 18px; font-weight: bold;">${appState.healthMetrics.heartRate} bpm</p>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: var(--font-sm); color: var(--primary-color); font-weight: 600;">BMI</p>
                            <p style="margin: var(--spacing-xs) 0 0 0; font-size: 18px; font-weight: bold;">${appState.healthMetrics.bmi} kg/m¬≤</p>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: var(--font-sm); color: var(--primary-color); font-weight: 600;">Temperature</p>
                            <p style="margin: var(--spacing-xs) 0 0 0; font-size: 18px; font-weight: bold;">${appState.healthMetrics.temperature}¬∞C</p>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: var(--font-sm); color: var(--primary-color); font-weight: 600;">Glucose Level</p>
                            <p style="margin: var(--spacing-xs) 0 0 0; font-size: 18px; font-weight: bold;">${appState.healthMetrics.glucose} mg/dL</p>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: var(--font-sm); color: var(--primary-color); font-weight: 600;">O‚ÇÇ Saturation</p>
                            <p style="margin: var(--spacing-xs) 0 0 0; font-size: 18px; font-weight: bold;">${appState.healthMetrics.oxygenSat}%</p>
                        </div>
                    </div>
                    <p style="margin-top: var(--spacing-lg); margin-bottom: 0; font-size: var(--font-sm); color: #7f8c8d;">Last updated: ${appState.healthMetrics.lastUpdated}</p>
                </div>

                <div style="margin-top: var(--spacing-lg); padding: var(--spacing-lg); background-color: #d6eaf8; border-radius: var(--border-radius); border-left: 4px solid var(--info-color);">
                    <h4 style="margin: 0 0 var(--spacing-md) 0; color: var(--info-color);">üìä Health Analysis</h4>
                    <ul style="margin: 0; padding-left: var(--spacing-lg); font-size: var(--font-sm);">
                        <li style="margin-bottom: var(--spacing-sm);">Your blood pressure is <strong>${appState.healthMetrics.bloodPressure.includes('120') ? 'normal' : 'abnormal'}</strong></li>
                        <li style="margin-bottom: var(--spacing-sm);">Heart rate is <strong>${appState.healthMetrics.heartRate > 100 ? 'elevated' : 'normal'}</strong></li>
                        <li style="margin-bottom: var(--spacing-sm);">BMI status: <strong>${appState.healthMetrics.bmi < 18.5 ? 'Underweight' : appState.healthMetrics.bmi < 25 ? 'Normal' : appState.healthMetrics.bmi < 30 ? 'Overweight' : 'Obese'}</strong></li>
                        <li>Oxygen saturation is <strong>${appState.healthMetrics.oxygenSat >= 95 ? 'excellent' : 'acceptable'}</strong></li>
                    </ul>
                </div>
            `;

            showAlert('metricsSuccess', '‚úÖ Health metrics updated successfully!', 'success');
        }

        function displayMedicalRecords() {
            const container = document.getElementById('medicalRecordsContainer');
            if (appState.appointments.filter(a => a.status === 'COMPLETED' && a.report_uploaded).length === 0) {
                container.innerHTML = '<p>No medical records found. Your doctor will add records after consultation.</p>';
            } else {
                container.innerHTML = '';
                appState.appointments.filter(a => a.status === 'COMPLETED' && a.report_uploaded).forEach(apt => {
                    const recordDiv = document.createElement('div');
                    recordDiv.className = 'medical-record';
                    const dateObj = new Date(apt.appointment_date);
                    const dateStr = dateObj.toLocaleDateString();

                    recordDiv.innerHTML = `
                        <div class="record-date">üìÖ ${dateStr}</div>
                        <div class="record-title">Dr. ${apt.doctor_name}</div>
                        <div style="margin-bottom: var(--spacing-md);">
                            <h5 style="margin: var(--spacing-sm) 0; color: var(--primary-color);">Diagnosis:</h5>
                            <p style="margin: var(--spacing-xs) 0; font-size: var(--font-sm);">${apt.meeting_report.diagnosis}</p>
                        </div>
                        <div style="margin-bottom: var(--spacing-md);">
                            <h5 style="margin: var(--spacing-sm) 0; color: var(--primary-color);">Treatment:</h5>
                            <p style="margin: var(--spacing-xs) 0; font-size: var(--font-sm);">${apt.meeting_report.treatment}</p>
                        </div>
                        ${apt.meeting_report.recommendations ? `
                            <div>
                                <h5 style="margin: var(--spacing-sm) 0; color: var(--primary-color);">Recommendations:</h5>
                                <p style="margin: var(--spacing-xs) 0; font-size: var(--font-sm);">${apt.meeting_report.recommendations}</p>
                            </div>
                        ` : ''}
                    `;
                    container.appendChild(recordDiv);
                });
            }
        }

        // ========================================
        // FEATURE 4: ROLE-BASED AI ANALYTICS ACCESS
        // ========================================
        function loadAIData() {
            const accessBadge = document.getElementById('accessBadge');
            const doctorTabs = ['admissionsTabBtn', 'alertsTabBtn', 'readmissionTabBtn', 'departmentsTabBtn'];

            if (appState.currentUser.role === 'DOCTOR') {
                accessBadge.textContent = 'DOCTOR ACCESS';
                accessBadge.className = 'analytics-access-badge doctor';
                
                doctorTabs.forEach(tabId => {
                    document.getElementById(tabId).style.display = 'inline-block';
                });
                document.getElementById('patientRestrictedMessage').classList.add('hidden');

                // Load doctor data
                loadDoctorAnalytics();
            } else {
                accessBadge.textContent = 'LIMITED ACCESS';
                accessBadge.className = 'analytics-access-badge patient';
                
                doctorTabs.forEach(tabId => {
                    document.getElementById(tabId).style.display = 'none';
                });
                document.getElementById('patientRestrictedMessage').classList.remove('hidden');
            }
        }

        function loadDoctorAnalytics() {
            // Populate admissions table
            const admissionsTableBody = document.getElementById('admissionsTableBody');
            admissionsTableBody.innerHTML = `
                <tr>
                    <td>2024-12-10</td>
                    <td><strong>145</strong></td>
                    <td>87%</td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; background-color: #d5f4e6; color: #27ae60; font-weight: 600;">LOW</span></td>
                </tr>
                <tr>
                    <td>2024-12-11</td>
                    <td><strong>168</strong></td>
                    <td>85%</td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; background-color: #fdebd0; color: #f39c12; font-weight: 600;">MEDIUM</span></td>
                </tr>
                <tr>
                    <td>2024-12-12</td>
                    <td><strong>178</strong></td>
                    <td>82%</td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; background-color: #fdebd0; color: #f39c12; font-weight: 600;">MEDIUM</span></td>
                </tr>
                <tr>
                    <td>2024-12-13</td>
                    <td><strong>152</strong></td>
                    <td>88%</td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; background-color: #d5f4e6; color: #27ae60; font-weight: 600;">LOW</span></td>
                </tr>
            `;

            // Populate readmission table
            const readmissionTableBody = document.getElementById('readmissionTableBody');
            readmissionTableBody.innerHTML = `
                <tr>
                    <td>Patient 1</td>
                    <td><strong>78%</strong></td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; background-color: #fadbd8; color: #e74c3c; font-weight: 600;">HIGH</span></td>
                </tr>
                <tr>
                    <td>Patient 2</td>
                    <td><strong>65%</strong></td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; background-color: #fdebd0; color: #f39c12; font-weight: 600;">MEDIUM</span></td>
                </tr>
                <tr>
                    <td>Patient 3</td>
                    <td><strong>42%</strong></td>
                    <td><span style="padding: 4px 8px; border-radius: 4px; background-color: #d5f4e6; color: #27ae60; font-weight: 600;">LOW</span></td>
                </tr>
            `;
        }

        function showTab(tabName) {
            const tabs = ['overviewTab', 'admissionsTab', 'alertsTab', 'readmissionTab', 'departmentsTab'];
            tabs.forEach(tab => {
                document.getElementById(tab).classList.remove('show');
            });
            document.getElementById(tabName + 'Tab').classList.add('show');

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // ========================================
        // BED MANAGEMENT
        // ========================================
        function loadBeds() {
            appState.allBeds = mockBeds;
            appState.beds = mockBeds;

            const totalBeds = mockBeds.length;
            const occupiedBeds = mockBeds.filter(b => b.status === 'OCCUPIED').length;
            const availableBeds = mockBeds.filter(b => b.status === 'AVAILABLE').length;
            const occupancyRate = totalBeds ? (occupiedBeds / totalBeds * 100).toFixed(1) : 0;

            document.getElementById('totalBeds').textContent = totalBeds;
            document.getElementById('occupiedBeds').textContent = occupiedBeds;
            document.getElementById('availableBeds').textContent = availableBeds;
            document.getElementById('occupancyRate').textContent = occupancyRate + '%';

            displayBeds(mockBeds);
        }

        function displayBeds(beds) {
            const bedsGrid = document.getElementById('bedsGrid');
            bedsGrid.innerHTML = '';

            if (beds.length === 0) {
                bedsGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: var(--spacing-xl);"><p>No beds found</p></div>';
            } else {
                beds.forEach(bed => {
                    const bedCard = document.createElement('div');
                    bedCard.className = `card`;
                    bedCard.innerHTML = `
                        <div style="background: linear-gradient(135deg, var(--primary-color) 0%, #156c5a 100%); color: white; padding: var(--spacing-lg); border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="margin: 0; color: white;">Bed ${bed.bed_number}</h4>
                            <span class="status-badge" style="background-color: ${bed.status === 'AVAILABLE' ? 'var(--success-color)' : 'var(--danger-color)'}; padding: 4px 12px; border-radius: 4px; font-size: var(--font-sm);">${bed.status}</span>
                        </div>
                        <div style="padding: var(--spacing-lg);">
                            <div style="display: flex; justify-content: space-between; padding: var(--spacing-sm) 0; font-size: var(--font-sm); border-bottom: 1px solid var(--border-color);">
                                <span style="font-weight: 600; color: var(--primary-color);">Ward:</span>
                                <span>${bed.ward}</span>
                            </div>
                            ${bed.patient_name ? `
                                <div style="display: flex; justify-content: space-between; padding: var(--spacing-sm) 0; font-size: var(--font-sm); border-bottom: 1px solid var(--border-color);">
                                    <span style="font-weight: 600; color: var(--primary-color);">Patient:</span>
                                    <span>${bed.patient_name}</span>
                                </div>
                            ` : ''}
                            <div style="display: flex; justify-content: space-between; padding: var(--spacing-sm) 0; font-size: var(--font-sm);">
                                <span style="font-weight: 600; color: var(--primary-color);">Priority:</span>
                                <span style="padding: 2px 8px; border-radius: 4px; font-weight: 600; ${bed.priority === 'Critical' ? 'background-color: #fee; color: var(--danger-color);' : 'background-color: #efe; color: var(--success-color);'}">${bed.priority}</span>
                            </div>
                        </div>
                    `;
                    bedsGrid.appendChild(bedCard);
                });
            }
        }

        function filterBeds() {
            const searchTerm = document.getElementById('bedSearch').value.toLowerCase();
            const wardFilter = document.getElementById('bedWardFilter').value;

            let filtered = appState.allBeds.filter(bed => {
                const matchesSearch = !searchTerm || bed.bed_number.toLowerCase().includes(searchTerm) || (bed.patient_name && bed.patient_name.toLowerCase().includes(searchTerm));
                const matchesWard = !wardFilter || bed.ward === wardFilter;
                return matchesSearch && matchesWard;
            });

            displayBeds(filtered);
        }

        function loadDoctorStats() {
            const totalPatients = appState.appointments.length;
            const todayAppointments = appState.appointments.filter(apt => apt.status === 'SCHEDULED').length;
            const completedAppointments = appState.appointments.filter(apt => apt.status === 'COMPLETED').length;
            const pendingUploads = appState.appointments.filter(apt => apt.status === 'COMPLETED' && !apt.report_uploaded).length;

            if (document.getElementById('totalPatients')) {
                document.getElementById('totalPatients').textContent = totalPatients;
                document.getElementById('todayAppointments').textContent = todayAppointments;
                document.getElementById('completedAppointments').textContent = completedAppointments;
                document.getElementById('pendingUploads').textContent = pendingUploads;
            }
        }

        // ========================================
        // MODAL FUNCTIONS
        // ========================================
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // ========================================
        // INITIALIZE APP
        // ========================================
        window.addEventListener('load', function() {
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                appState.currentUser = JSON.parse(savedUser);
                appState.isLoggedIn = true;
                showMainContent();
            }
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = ['appointmentModal', 'uploadReportModal', 'rescheduleModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.classList.remove('show');
                }
            });
        };
    </script>
</body>
</html>
